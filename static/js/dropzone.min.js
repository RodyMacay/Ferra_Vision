// Asegúrate de que este script se cargue después de que el DOM esté completamente cargado
document.addEventListener('DOMContentLoaded', function() {
    Dropzone.autoDiscover = false;

    var myDropzone = new Dropzone("#imageUpload", {
        url: "/upload/", // Asegúrate de que esta URL coincida con tu configuración de Django
        paramName: "file",
        maxFilesize: 5, // MB
        acceptedFiles: "image/jpeg,image/png",
        dictDefaultMessage: "Arrastra y suelta archivos aquí o haz clic para seleccionar",
        dictFallbackMessage: "Tu navegador no soporta la carga de archivos por arrastrar y soltar.",
        dictFileTooBig: "El archivo es demasiado grande ({{filesize}}MB). Tamaño máximo: {{maxFilesize}}MB.",
        dictInvalidFileType: "No puedes subir archivos de este tipo.",
        dictResponseError: "El servidor respondió con {{statusCode}} code.",
        dictCancelUpload: "Cancelar carga",
        dictUploadCanceled: "Carga cancelada.",
        dictRemoveFile: "Eliminar archivo",
        dictMaxFilesExceeded: "No puedes subir más archivos.",
        init: function() {
            this.on("addedfile", function(file) {
                // Limpiar previsualizaciones anteriores
                document.getElementById('imagePreview').src = '';
                document.getElementById('imagePreview').classList.add('hidden');
                document.getElementById('error').classList.add('hidden');

                // Crear una nueva previsualización
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                }
                reader.readAsDataURL(file);

                // Habilitar el botón de análisis
                document.getElementById('analyzeButton').disabled = false;
            });

            this.on("error", function(file, errorMessage) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('errorText').textContent = errorMessage;
            });

            this.on("success", function(file, response) {
                console.log("Archivo cargado con éxito:", response);
                // Aquí puedes agregar lógica adicional después de una carga exitosa
            });
        }
    });

    // Manejar el clic en el botón de análisis
    document.getElementById('analyzeButton').addEventListener('click', function() {
        // Aquí puedes agregar lógica adicional antes de enviar el formulario
        document.getElementById('imageUpload').submit();
    });
});